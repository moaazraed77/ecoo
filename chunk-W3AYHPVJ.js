import{$c as he,F as Y,Ma as Q,R as S,Rc as L,Sc as ie,Tc as se,Uc as ae,V as Z,Vc as ce,Wc as v,Xc as le,Y as w,Yc as ue,Zc as U,_ as d,_c as de,ad as fe,bd as pe,cd as ge,dd as me,ed as _e,f,fc as ee,fd as Te,gc as D,gd as ke,hc as te,hd as we,i as G,ic as re,id as Ee,jc as E,jd as Ae,kc as ne,kd as $,lc as M,ld as ve,mc as x,nd as be,o as k,p as C,qc as N,rc as oe,sc as O,t as X,tc as F,wa as J}from"./chunk-4CM3PSM5.js";var Ue=new Map,$e={activated:!1,tokenObservers:[]},je={initialized:!1,enabled:!1};function h(t){return Ue.get(t)||Object.assign({},$e)}function Ce(){return je}var He="https://content-firebaseappcheck.googleapis.com/v1";var Be="exchangeDebugToken",Re={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},Mt=24*60*60*1e3;var H=class{constructor(e,r,n,o,i){if(this.operation=e,this.retryPolicy=r,this.getWaitDuration=n,this.lowerBound=o,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=o,o>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return f(this,null,function*(){this.stop();try{this.pending=new D,this.pending.promise.catch(r=>{}),yield Ke(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new D,this.pending.promise.catch(r=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(r){this.retryPolicy(r)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let r=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),r}}};function Ke(t){return new Promise(e=>{setTimeout(e,t)})}var ze={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},p=new re("appCheck","AppCheck",ze);function Se(t){if(!h(t).activated)throw p.create("use-before-activation",{appName:t.name})}function De(n,o){return f(this,arguments,function*({url:t,body:e},r){let i={"Content-Type":"application/json"},s=r.getImmediate({optional:!0});if(s){let c=yield s.getHeartbeatsHeader();c&&(i["X-Firebase-Client"]=c)}let l={method:"POST",body:JSON.stringify(e),headers:i},a;try{a=yield fetch(t,l)}catch(c){throw p.create("fetch-network-error",{originalErrorMessage:c?.message})}if(a.status!==200)throw p.create("fetch-status-error",{httpStatus:a.status});let u;try{u=yield a.json()}catch(c){throw p.create("fetch-parse-error",{originalErrorMessage:c?.message})}let m=u.ttl.match(/^([\d.]+)(s)$/);if(!m||!m[2]||isNaN(Number(m[1])))throw p.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${u.ttl}`});let q=Number(m[1])*1e3,_=Date.now();return{token:u.token,expireTimeMillis:_+q,issuedAtTimeMillis:_}})}function Me(t,e){let{projectId:r,appId:n,apiKey:o}=t.options;return{url:`${He}/projects/${r}/apps/${n}:${Be}?key=${o}`,body:{debug_token:e}}}var We="firebase-app-check-database",qe=1,B="firebase-app-check-store";var b=null;function Ve(){return b||(b=new Promise((t,e)=>{try{let r=indexedDB.open(We,qe);r.onsuccess=n=>{t(n.target.result)},r.onerror=n=>{var o;e(p.create("storage-open",{originalErrorMessage:(o=n.target.error)===null||o===void 0?void 0:o.message}))},r.onupgradeneeded=n=>{let o=n.target.result;switch(n.oldVersion){case 0:o.createObjectStore(B,{keyPath:"compositeKey"})}}}catch(r){e(p.create("storage-open",{originalErrorMessage:r?.message}))}}),b)}function Ge(t,e){return Xe(Ye(t),e)}function Xe(t,e){return f(this,null,function*(){let n=(yield Ve()).transaction(B,"readwrite"),i=n.objectStore(B).put({compositeKey:t,value:e});return new Promise((s,l)=>{i.onsuccess=a=>{s()},n.onerror=a=>{var u;l(p.create("storage-set",{originalErrorMessage:(u=a.target.error)===null||u===void 0?void 0:u.message}))}})})}function Ye(t){return`${t.options.appId}-${t.name}`}var K=new ne("@firebase/app-check");function j(t,e){return te()?Ge(t,e).catch(r=>{K.warn(`Failed to write token to IndexedDB. Error: ${r}`)}):Promise.resolve()}function xe(){return Ce().enabled}function Ne(){return f(this,null,function*(){let t=Ce();if(t.enabled&&t.token)return t.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var Ze={error:"UNKNOWN_ERROR"};function Je(t){return ee.encodeString(JSON.stringify(t),!1)}function z(t,e=!1){return f(this,null,function*(){let r=t.app;Se(r);let n=h(r),o=n.token,i;if(o&&!A(o)&&(n.token=void 0,o=void 0),!o){let a=yield n.cachedTokenPromise;a&&(A(a)?o=a:yield j(r,void 0))}if(!e&&o&&A(o))return{token:o.token};let s=!1;if(xe()){n.exchangeTokenPromise||(n.exchangeTokenPromise=De(Me(r,yield Ne()),t.heartbeatServiceProvider).finally(()=>{n.exchangeTokenPromise=void 0}),s=!0);let a=yield n.exchangeTokenPromise;return yield j(r,a),n.token=a,{token:a.token}}try{n.exchangeTokenPromise||(n.exchangeTokenPromise=n.provider.getToken().finally(()=>{n.exchangeTokenPromise=void 0}),s=!0),o=yield h(r).exchangeTokenPromise}catch(a){a.code==="appCheck/throttled"?K.warn(a.message):K.error(a),i=a}let l;return o?i?A(o)?l={token:o.token,internalError:i}:l=Ie(i):(l={token:o.token},n.token=o,yield j(r,o)):l=Ie(i),s&&rt(r,l),l})}function Qe(t){return f(this,null,function*(){let e=t.app;Se(e);let{provider:r}=h(e);if(xe()){let n=yield Ne(),{token:o}=yield De(Me(e,n),t.heartbeatServiceProvider);return{token:o}}else{let{token:n}=yield r.getToken();return{token:n}}})}function et(t,e,r,n){let{app:o}=t,i=h(o),s={next:r,error:n,type:e};if(i.tokenObservers=[...i.tokenObservers,s],i.token&&A(i.token)){let l=i.token;Promise.resolve().then(()=>{r({token:l.token}),ye(t)}).catch(()=>{})}i.cachedTokenPromise.then(()=>ye(t))}function Oe(t,e){let r=h(t),n=r.tokenObservers.filter(o=>o.next!==e);n.length===0&&r.tokenRefresher&&r.tokenRefresher.isRunning()&&r.tokenRefresher.stop(),r.tokenObservers=n}function ye(t){let{app:e}=t,r=h(e),n=r.tokenRefresher;n||(n=tt(t),r.tokenRefresher=n),!n.isRunning()&&r.isTokenAutoRefreshEnabled&&n.start()}function tt(t){let{app:e}=t;return new H(()=>f(this,null,function*(){let r=h(e),n;if(r.token?n=yield z(t,!0):n=yield z(t),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let r=h(e);if(r.token){let n=r.token.issuedAtTimeMillis+(r.token.expireTimeMillis-r.token.issuedAtTimeMillis)*.5+3e5,o=r.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,o),Math.max(0,n-Date.now())}else return 0},Re.RETRIAL_MIN_WAIT,Re.RETRIAL_MAX_WAIT)}function rt(t,e){let r=h(t).tokenObservers;for(let n of r)try{n.type==="EXTERNAL"&&e.error!=null?n.error(e.error):n.next(e)}catch{}}function A(t){return t.expireTimeMillis-Date.now()>0}function Ie(t){return{token:Je(Ze),error:t}}var W=class{constructor(e,r){this.app=e,this.heartbeatServiceProvider=r}_delete(){let{tokenObservers:e}=h(this.app);for(let r of e)Oe(this.app,r.next);return Promise.resolve()}};function nt(t,e){return new W(t,e)}function ot(t){return{getToken:e=>z(t,e),getLimitedUseToken:()=>Qe(t),addTokenListener:e=>et(t,"INTERNAL",e),removeTokenListener:e=>Oe(t.app,e)}}var it="@firebase/app-check",st="0.8.4";var at="app-check",Pe="app-check-internal";function ct(){M(new E(at,t=>{let e=t.getProvider("app").getImmediate(),r=t.getProvider("heartbeat");return nt(e,r)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,r)=>{t.getProvider(Pe).initialize()})),M(new E(Pe,t=>{let e=t.getProvider("app-check").getImmediate();return ot(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),x(it,st)}ct();var lt=["localhost","0.0.0.0","127.0.0.1"],zt=typeof window<"u"&&lt.includes(window.location.hostname);var T=class{constructor(e,r,n){this._delegate=e,this.task=r,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}};var R=class{constructor(e,r){this._delegate=e,this._ref=r,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new T(this._delegate.snapshot,this,this._ref)}then(e,r){return this._delegate.then(n=>{if(e)return e(new T(n,this,this._ref))},r)}on(e,r,n,o){let i;return r&&(typeof r=="function"?i=s=>r(new T(s,this,this._ref)):i={next:r.next?s=>r.next(new T(s,this,this._ref)):void 0,complete:r.complete||void 0,error:r.error||void 0}),this._delegate.on(e,i,n||void 0,o||void 0)}},y=class{constructor(e,r){this._delegate=e,this._service=r}get prefixes(){return this._delegate.prefixes.map(e=>new g(e,this._service))}get items(){return this._delegate.items.map(e=>new g(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}};var g=class t{constructor(e,r){this._delegate=e,this.storage=r}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){let r=ve(this._delegate,e);return new t(r,this.storage)}get root(){return new t(this._delegate.root,this.storage)}get parent(){let e=this._delegate.parent;return e==null?null:new t(e,this.storage)}put(e,r){return this._throwIfRoot("put"),new R(me(this._delegate,e,r),this)}putString(e,r=U.RAW,n){this._throwIfRoot("putString");let o=de(r,e),i=Object.assign({},n);return i.contentType==null&&o.contentType!=null&&(i.contentType=o.contentType),new R(new ge(this._delegate,new he(o.data,!0),i),this)}listAll(){return we(this._delegate).then(e=>new y(e,this.storage))}list(e){return ke(this._delegate,e||void 0).then(r=>new y(r,this.storage))}getMetadata(){return _e(this._delegate)}updateMetadata(e){return Te(this._delegate,e)}getDownloadURL(){return Ee(this._delegate)}delete(){return this._throwIfRoot("delete"),Ae(this._delegate)}_throwIfRoot(e){if(this._delegate._location.path==="")throw le(e)}};var I=class{constructor(e,r){this.app=e,this._delegate=r}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(Fe(e))throw v("ref() expected a child path but got a URL, use refFromURL instead.");return new g($(this._delegate,e),this)}refFromURL(e){if(!Fe(e))throw v("refFromURL() expected a full URL but got a child path, use ref() instead.");try{ue.makeFromUrl(e,this._delegate.host)}catch{throw v("refFromUrl() expected a valid full URL but got an invalid one.")}return new g($(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,r,n={}){be(this._delegate,e,r,n)}};function Fe(t){return/^[A-Za-z]+:\/\//.test(t)}var dt="@firebase/storage-compat",ht="0.3.8";var ft="storage-compat";function pt(t,{instanceIdentifier:e}){let r=t.getProvider("app-compat").getImmediate(),n=t.getProvider("storage").getImmediate({identifier:e});return new I(r,n)}function gt(t){let e={TaskState:pe,TaskEvent:fe,StringFormat:U,Storage:I,Reference:g};t.INTERNAL.registerComponent(new E(ft,pt,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),t.registerVersion(dt,ht)}gt(L);function mt(t){return new G(e=>{let r=s=>e.next(s),n=s=>e.error(s),o=()=>e.complete();r(t.snapshot);let i=t.on("state_changed",r);return t.then(s=>{r(s),o()},s=>{r(t.snapshot),n(s)}),function(){i()}}).pipe(Y(0))}function Le(t){let e=mt(t);return{task:t,then:t.then.bind(t),catch:t.catch.bind(t),pause:t.pause.bind(t),cancel:t.cancel.bind(t),resume:t.resume.bind(t),snapshotChanges:()=>e,percentageChanges:()=>e.pipe(X(r=>r.bytesTransferred/r.totalBytes*100))}}function P(t){return{getDownloadURL:()=>C(void 0).pipe(O,S(()=>t.getDownloadURL()),F),getMetadata:()=>C(void 0).pipe(O,S(()=>t.getMetadata()),F),delete:()=>k(t.delete()),child:e=>P(t.child(e)),updateMetadata:e=>k(t.updateMetadata(e)),put:(e,r)=>{let n=t.put(e,r);return Le(n)},putString:(e,r,n)=>{let o=t.putString(e,r,n);return Le(o)},list:e=>k(t.list(e)),listAll:()=>k(t.listAll())}}var _t=new w("angularfire2.storageBucket"),Tt=new w("angularfire2.storage.maxUploadRetryTime"),kt=new w("angularfire2.storage.maxOperationRetryTime"),wt=new w("angularfire2.storage.use-emulator"),kr=(()=>{class t{storage;constructor(r,n,o,i,s,l,a,u,m,q){let _=ae(r,s,n);this.storage=ce(`${_.name}.storage.${o}`,"AngularFireStorage",_.name,()=>{let c=s.runOutsideAngular(()=>_.storage(o||void 0)),V=m;return V&&c.useEmulator(...V),a&&c.setMaxUploadRetryTime(a),u&&c.setMaxOperationRetryTime(u),c},[a,u])}ref(r){return P(this.storage.ref(r))}refFromURL(r){return P(this.storage.refFromURL(r))}upload(r,n,o){let i=this.storage.ref(r);return P(i).put(n,o)}static \u0275fac=function(n){return new(n||t)(d(ie),d(se,8),d(_t,8),d(J),d(Q),d(oe),d(Tt,8),d(kt,8),d(wt,8),d(N,8))};static \u0275prov=Z({token:t,factory:t.\u0275fac,providedIn:"any"})}return t})();export{kr as a};
